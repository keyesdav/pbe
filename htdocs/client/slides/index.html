<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>PBE Testing Presentation</title>

		<meta name="description" content="Test of the Pathfinder Bible Experience competition.">
		<meta name="author" content="David S. Keyes">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		
		<link rel="stylesheet" href="css/pbe.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script type="text/javascript" src="./bower_components/purl/purl.js"></script>

		
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body class="pbeback">

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides pbe">
				<section >
					<img class='pbelogo' src='./img/pbe-logo.png'/><div class='pbetitle'><h1>PBE Online</h1></div>
					<div class='pbecontent'>
						<p>Loading test from cloud and generating presentation.<br/><br/>Please wait...</p>
						<br/><br/><br/>
						<p>
							<small>Copyright 2015, <a href="http://keyeslabs.com">David S. Keyes</a></small>
						</p>
					</div>
				</section>


			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script type="text/javascript" src="./bower_components/reveal-add-remove.js/js/reveal-add-remove.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
			
			
			setTimeout(getData, 250);
			
			function getData(){
				
				// figure out the id of the test that we want to render
				var id = $.url().param('id');

				
				$.ajax("/api/pbe/tests/"+id).done(function(tResp){
					var test = tResp;
					
					// $.ajax("/api/pbe/questions/Exodus").done(function(qResp){
					// 	var questions = qResp;
						
					// 	addSlides(test, questions);
					// });
					
					// remove the title slide...
					
					addSlides(test);

					setTimeout( function(){Reveal.next(); Reveal.remove(0)}, 500);
					// Reveal.remove(0);

				});
			}
			
			function addSlides(test){
				
				var testQs = test.Questions;
				
				var bibleDeferreds = [];

				addTitleSlide(test);

				for(var j=0; j<testQs.length; j++){
					bibleDeferreds.push(instrumentQuestionWithBibleData(testQs[j]));
				}


				// after all of the bible verses have been loaded from the bible API, then generate slides...
				$.when.apply($, bibleDeferreds).then(function(){
					for(var i=0; i<testQs.length; i++){
						addSlidesForQuestion(i, testQs[i]);
					}
					
				});
				
				
				
			}
			
			function instrumentQuestionWithBibleData(question){
				var reqPromise = $.ajax("/api/bible/Exodus?verses="+question.verse).done(function(bibleData){
					question.bibleData = bibleData;
				});

				return reqPromise;				
			}
			
			function addTitleSlide(test){
				
				var slide1 = "<img class='pbelogo' src='./img/pbe-logo.png'/><div class='pbetitle'>"+
				  "<h1>PBE Quiz</h1></div>" +
				  "<div class='pbecontent'>" +
				  "<p class='q-text'><h2>"+test.Title+"</h2></p>" +
				  "<p class='q-text'>"+test.SubTitle+"</p><br/>" +
				  "<p class='q-intro'>"+test.Questions.length+" Questions<br/></p>" +
				  "</div>";
				Reveal.add(slide1, null, "pbe_title");

				// $("#pbe_title").attr("data-transition", "convex-in fade-out");

			}
			
			function addSlidesForQuestion(qNum, question){
				
			
				var time = 25;
				time += (question.points-1)*5;

				var slide1 = "<img class='pbelogo' src='./img/pbe-logo.png'/><div class='pbetitle'>"+
				  "<h1>Question #" + (qNum+1) + "</h1></div>" +
				  "<div class='pbecontent'>" +
				  "<p class='q-intro'>" + "For "+question.points+" point"+((question.points>1) ? "s" : "")+" - According to Exodus "+question.verse+":" + "<br/></p>" +
				  "<p class='q-text'>"+question.question+"<br/></p>" +
				  "<p class='q-intro'>("+time+" seconds)</p>" +
				  "</div>";
				Reveal.add(slide1, null, "pbe_q"+qNum+"_1");

				$("#pbe_q"+qNum+"_1").attr("data-transition", "convex-in fade-out");

				var slide2 = "<section class='future'><img class='pbelogo' src='./img/pbe-logo.png'/><div class='pbetitle'>"+
				  "<h1>Question #" + (qNum+1) + "</h1></div>" +
				  "<div class='pbecontent'>" +
				  "<p class='q-intro'>" + "For "+question.points+" point"+((question.points>1) ? "s" : "")+" - According to Exodus "+question.verse+":" + "<br/></p>" +
				  "<p class='q-text-dim'>"+question.question+"<br/></p>" +
				  "<p class='q-text'>Answer: "+question.answer+"</p>" +
				  "</div></section>" +
				  "<section class='future'><img class='pbelogo' src='./img/pbe-logo.png'/><div class='pbetitle'>"+
				  "<h1>" + "NKJV Bible" + "</h1></div>" +
				  "<div class='pbecontent'>" +
				  "<p class='q-intro'>" + "Exodus " +question.verse+ "</p>";
				  for(var b=0;b<question.bibleData.verses.length; b++){
				  	slide2 += "<p class='q-text-bible'><span class='q-text-bible-verse-number'>"+question.bibleData.verses[b].num+"</span>  "+question.bibleData.verses[b].text+"</p>";
				  }
				  slide2 += "</div></section>";
				Reveal.add(slide2, null, "pbe_q"+qNum+"_2");

				$("#pbe_q"+qNum+"_2").attr("data-transition", "fade-in convex-out");
				$("#pbe_q"+qNum+"_2 section").first().attr("data-transition", "fade-in convex-out");
				$("#pbe_q"+qNum+"_2 section").last().attr("data-transition", "convex-in convex-out");
				// $("#pbe_q"+qNum+"_2 section").last().attr("data-transition", "none-in convex-out");

			}

		</script>

	</body>
</html>
